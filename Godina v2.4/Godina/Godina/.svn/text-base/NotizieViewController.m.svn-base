//
//  NotizieViewController.m
//  Godina
//
//  Created by Fabio on 14/09/12.
//  Copyright (c) 2012 Fabio. All rights reserved.
//

#import "NotizieViewController.h"
#import "DejalActivityView.h" // <= caricamento
//#import "ODRefreshControl.h"

@interface NotizieViewController ()

@end

@implementation NotizieViewController

@synthesize webNotizie;


- (void)viewDidLoad
{
    [super viewDidLoad];
    
//    ODRefreshControl *refreshControl = [[ODRefreshControl alloc] initInScrollView:self.tableView];
//    [refreshControl addTarget:self action:@selector(dropViewDidBeginRefreshing:) forControlEvents:UIControlEventValueChanged];
    
    webNotizie.delegate = self;
    
    NSUserDefaults *prefs = [NSUserDefaults standardUserDefaults];

    [prefs setObject:nil forKey:@"nnl"];
    
    [prefs synchronize];
    
    [[super.tabBarController.viewControllers objectAtIndex:2] tabBarItem].badgeValue = nil;
      
    
}

- (void)webViewDidFinishLoad:(UIWebView *)webView
{
	// finished loading, hide the activity indicator in the status bar
    NSLog(@"View NOTIZIE CARICAMENTO ULTIMATO");
    [DejalBezelActivityView removeViewAnimated:YES];
}

//- (void)dropViewDidBeginRefreshing:(ODRefreshControl *)refreshControl
//{
//    double delayInSeconds = 3.0;
//    dispatch_time_t popTime = dispatch_time(DISPATCH_TIME_NOW, delayInSeconds * NSEC_PER_SEC);
//    dispatch_after(popTime, dispatch_get_main_queue(), ^(void){
//        
//        
//        [refreshControl endRefreshing];
//    });
//}

- (void)didReceiveMemoryWarning
{
    [super didReceiveMemoryWarning];
    // Dispose of any resources that can be recreated.
}
- (void)viewWillAppear:(BOOL)animated
{
    [DejalBezelActivityView activityViewForView:self.view withLabel:@"Caricamento"];
    
    NSUserDefaults *prefs = [NSUserDefaults standardUserDefaults];
    
    [prefs setObject:nil forKey:@"nnl"];
    
    [prefs synchronize];
    
    [[super.tabBarController.viewControllers objectAtIndex:2] tabBarItem].badgeValue = nil;
    
    NSString *indirizzo = @"http://app.godina.it/newsios6/framework";
	//crea un oggetto URL
	NSURL *url = [NSURL URLWithString:indirizzo];
	NSURLRequest *requestObj = [NSURLRequest requestWithURL:url];
	// visualizza la pagina nella UIWebView
	[webNotizie loadRequest:requestObj];
    
    NSLog(@"View NOTIZIE ricaricata, leggo: %@", indirizzo);
    
//    [[self navigationController] tabBarItem].badgeValue = @"3";


    
}

@end
